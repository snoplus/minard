{% extends "layout.html" %}
{% block title %}ECAL Status{% endblock %}
{% block head %}
    {{ super() }}
    <style>
        .noel tbody tr:nth-child(even) {
            background-color: #ffffff;
        }
        .noel tbody tr:nth-child(odd) {
            background-color: #adffad;
        }
    </style>
{% endblock %}
{% block body %}
    {{ super() }}
    <div class="container">
	<div class="row">
	    <div class="col-md-12">
                <h4> Find ECAL Settings by CCC </h4>
                Crate/Card/Channel
                <select id="crate">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                </select>
                /
                <select id="slot">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                </select>
                /
                <select id="channel">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                </select>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <td> MBID </td>
                            <td> DBID </td>
                            <td> VBal Low DAC </td>
                            <td> VBal High DAC </td>
                            <td> VThr DAC </td>
                            <td> ISETM0 DAC </td>
                            <td> ISETM1 DAC </td>
                            <td> RMP DAC </th>
                        </tr>
                    </thead>
                    <tr>
                        <td> {{ ecal_data['mbid'] }} </td>
                        <td> {{ ecal_data['dbid'] }} </td>
                        <td> {{ ecal_data['vbal_0'] }} </td>
                        <td> {{ ecal_data['vbal_1'] }} </td>
                        <td> {{ ecal_data['vthr'] }} </td>
                        <td> {{ ecal_data['isetm0'] }} </td>
                        <td> {{ ecal_data['isetm1'] }} </td>
                        <td> {{ ecal_data['rmp'] }} </td>
                    </tr>
                </table>
                <h4> Find Channels Failing the Following Test </h4>
                Test Failed:
                <select id="test">
                    <option value=-1>All</option>
                    <option value=0>Crate CBal</option>
                    <option value=1>ZDisc</option>
                    <option value=2>Set TTot</option>
                    <option value=3>GTValid</option>
                    <option value=4>Pedestal</option>
                    <option value=5>CGT</option>
                    <option value=6>Get TTot</option>
                    <option value=7>FEC Test</option>
                    <option value=8>Disc Check</option>
                </select>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <td> Crate </td>
                            <td> Slot </td>
                            <td> Channel </td>
                            <td> Tests Failed </td>
                        <tr>
                    </thead>
                    {% if ccc %}
                        {% for crate, slot, channel, test in ccc %}
                            <tr>
                                <td> {{ crate }} </td>
                                <td> {{ slot }} </td>
                                <td> {{ channel }} </td>
                                <td> {{ test }} </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <td> None! </td>
                    {% endif %}
                </table>
            </div>
        </div>
    </div>
{% endblock %}
{% block script %}
    <script>
        if (url_params.crate) {
            document.getElementById("crate").value = url_params.crate;
        }
        if (url_params.slot) {
            document.getElementById("slot").value = url_params.slot;
        }
        if (url_params.channel) {
            document.getElementById("channel").value = url_params.channel;
        }
        if (url_params.test) {
            document.getElementById("test").value = url_params.test;
        }
        $("#crate, #slot, #channel, #test").on("change", function() {
            var params = {};
            if (document.getElementById("crate").value != -1) {
                params['crate'] = document.getElementById("crate").value;
            }
            if (document.getElementById("slot").value != -1) {
                params['slot'] = document.getElementById("slot").value;
            }
            if (document.getElementById("channel").value != -1) {
                params['channel'] = document.getElementById("channel").value;
            }
            if (document.getElementById("test").value != "") {
                params['test'] = document.getElementById("test").value;
            }
            window.location.replace($SCRIPT_ROOT + "/ecal-status?" + $.param(params));
        });
    </script>
{% endblock %}
